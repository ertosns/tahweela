\hypertarget{namespacecore_1_1server_1_1server}{}\doxysection{core.\+server.\+server Namespace Reference}
\label{namespacecore_1_1server_1_1server}\index{core.server.server@{core.server.server}}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \mbox{\hyperlink{namespacecore_1_1server_1_1server_a971d8b7372b9e3548a266ff9373e0ad5}{authenticate}} (user, passcode)
\item 
def \mbox{\hyperlink{namespacecore_1_1server_1_1server_ae03340bacb313931ea21ed616bf75cf0}{unauthorized}} ()
\item 
def \mbox{\hyperlink{namespacecore_1_1server_1_1server_a7abed3618dce8dfc82db88504621e7fa}{register\+\_\+client}} ()
\item 
def \mbox{\hyperlink{namespacecore_1_1server_1_1server_aa6df1567622a40f24e74f1daa3c424e9}{add\+\_\+bank\+\_\+account}} ()
\item 
def \mbox{\hyperlink{namespacecore_1_1server_1_1server_a2ccd3f4fc783a6da9115970238b12230}{add\+\_\+contact}} ()
\item 
def \mbox{\hyperlink{namespacecore_1_1server_1_1server_af238ee0ce6d5e29834c8f207b7cd7c41}{get\+\_\+balance}} ()
\item 
def \mbox{\hyperlink{namespacecore_1_1server_1_1server_a3ca347b24727d3a0c0789a0862916be4}{get\+\_\+total\+\_\+balance}} ()
\item 
def \mbox{\hyperlink{namespacecore_1_1server_1_1server_a5c1e2c8a284854a7b27c4fbf7144b038}{update\+\_\+balance\+\_\+preference}} ()
\item 
def \mbox{\hyperlink{namespacecore_1_1server_1_1server_a97a5fcbe887022d384ea97f7d3b7dc47}{update\+\_\+ledger}} ()
\item 
def \mbox{\hyperlink{namespacecore_1_1server_1_1server_aaa1ff2a38465c5ade1f235cf197dde62}{make\+\_\+transaction}} ()
\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacecore_1_1server_1_1server_ad2bf3b7601bca535e854bac189410f0b}{seed}} = int.\+from\+\_\+bytes(os.\+urandom(2), \textquotesingle{}big\textquotesingle{})
\item 
string \mbox{\hyperlink{namespacecore_1_1server_1_1server_aacc32d3c57c3b577b7e2647528baaf8c}{db\+\_\+configs}} = \char`\"{}dbname=\textquotesingle{}demo\textquotesingle{} user=\textquotesingle{}tahweela\textquotesingle{} password=\textquotesingle{}tahweela\textquotesingle{}\char`\"{}
\item 
\mbox{\hyperlink{namespacecore_1_1server_1_1server_a39c673ca728dfb59e5fa8e3da0dd8be9}{db}} = \mbox{\hyperlink{classcore_1_1queries_1_1database_1_1database}{database}}(\mbox{\hyperlink{namespacecore_1_1server_1_1server_aacc32d3c57c3b577b7e2647528baaf8c}{db\+\_\+configs}})
\item 
\mbox{\hyperlink{namespacecore_1_1server_1_1server_a4cc77d0b54229e293423876599326ce9}{filename}}
\item 
\mbox{\hyperlink{namespacecore_1_1server_1_1server_af52a36a8c5dfa466d4b0ecfe690fbaca}{format}}
\item 
\mbox{\hyperlink{namespacecore_1_1server_1_1server_adb9ec4bde84331664eb52b6412cb09fd}{filemode}}
\item 
\mbox{\hyperlink{namespacecore_1_1server_1_1server_a015041a18162a9c613c7321dd94c440e}{level}}
\item 
\mbox{\hyperlink{namespacecore_1_1server_1_1server_a826f85e804e434c97db7e6738226d717}{logger}} = logging.\+get\+Logger()
\item 
\mbox{\hyperlink{namespacecore_1_1server_1_1server_a67e902b543f6cff982320c5d78af065e}{app}} = Flask(\textquotesingle{}tahweela\textquotesingle{})
\item 
\mbox{\hyperlink{namespacecore_1_1server_1_1server_a4802bb7a7a649b4f4334af4d1a39b4d5}{secret\+\_\+key}}
\item 
\mbox{\hyperlink{namespacecore_1_1server_1_1server_a43a2e2d9bdeff715032f6df4b5396792}{auth}} = H\+T\+T\+P\+Basic\+Auth()
\item 
\mbox{\hyperlink{namespacecore_1_1server_1_1server_af424e5a3aad0db0c0b8cd014a17f2f5a}{debug}}
\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{namespacecore_1_1server_1_1server_aa6df1567622a40f24e74f1daa3c424e9}\label{namespacecore_1_1server_1_1server_aa6df1567622a40f24e74f1daa3c424e9}} 
\index{core.server.server@{core.server.server}!add\_bank\_account@{add\_bank\_account}}
\index{add\_bank\_account@{add\_bank\_account}!core.server.server@{core.server.server}}
\doxysubsubsection{\texorpdfstring{add\_bank\_account()}{add\_bank\_account()}}
{\footnotesize\ttfamily def core.\+server.\+server.\+add\+\_\+bank\+\_\+account (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\begin{DoxyVerb}register bank account for the authenticated client of the current session

@param: the post body is expect to be json with keys ["bank_name", branch_number", "account_number", "name_reference"], a client can register more than one bank account for tahweela account.
@return return bid (banking id), since multiple bank accounts are supported, bid need to be sent for each transaction so that, the transactions are done with it.
\end{DoxyVerb}
 

Definition at line 128 of file server.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{128 \textcolor{keyword}{def }\mbox{\hyperlink{namespacecore_1_1server_1_1server_aa6df1567622a40f24e74f1daa3c424e9}{add\_bank\_account}}():}
\DoxyCodeLine{129   \textcolor{stringliteral}{""" register bank account for the authenticated client of the current session}}
\DoxyCodeLine{130 \textcolor{stringliteral}{}}
\DoxyCodeLine{131 \textcolor{stringliteral}{  @param: the post body is expect to be json with keys ["bank\_name", branch\_number", "account\_number", "name\_reference"], a client can register more than one bank account for tahweela account.}}
\DoxyCodeLine{132 \textcolor{stringliteral}{  @return return bid (banking id), since multiple bank accounts are supported, bid need to be sent for each transaction so that, the transactions are done with it.}}
\DoxyCodeLine{133 \textcolor{stringliteral}{  """}}
\DoxyCodeLine{134   req=request.get\_json(force=\textcolor{keyword}{True})}
\DoxyCodeLine{135   bank\_name=req.get(\textcolor{stringliteral}{"bank\_name"}, \textcolor{keywordtype}{None})}
\DoxyCodeLine{136   branch\_number=req.get(\textcolor{stringliteral}{"branch\_number"}, \textcolor{keywordtype}{None})}
\DoxyCodeLine{137   account\_number=req.get(\textcolor{stringliteral}{"account\_number"}, \textcolor{keywordtype}{None})}
\DoxyCodeLine{138   name\_reference=req.get(\textcolor{stringliteral}{"name\_reference"}, \textcolor{stringliteral}{""})}
\DoxyCodeLine{139   \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} req \textcolor{keywordflow}{or} bank\_name==\textcolor{keywordtype}{None} \textcolor{keywordflow}{or} branch\_number==\textcolor{keywordtype}{None} \textcolor{keywordflow}{or} account\_number==\textcolor{keywordtype}{None}:}
\DoxyCodeLine{140       emsg=\textcolor{stringliteral}{"incomplete request"}}
\DoxyCodeLine{141       logger.critical(emsg)}
\DoxyCodeLine{142       abort(401, emsg)}
\DoxyCodeLine{143   db.init()}
\DoxyCodeLine{144   ADD\_BANK\_ACCOUNT\_LOCK=7}
\DoxyCodeLine{145   lock=ADD\_BANK\_ACCOUNT\_LOCK}
\DoxyCodeLine{146   \textcolor{keywordflow}{try}:}
\DoxyCodeLine{147     db.lock\_advisory(lock)}
\DoxyCodeLine{148     cid=db.gets.credid2cid(session[\textcolor{stringliteral}{'credid'}])}
\DoxyCodeLine{149     logger.debug(\textcolor{stringliteral}{"client added"})}
\DoxyCodeLine{150     bank=PaymentGate(bank\_name, branch\_number, account\_number, name\_reference)}
\DoxyCodeLine{151     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} bank.authenticated():}
\DoxyCodeLine{152         \textcolor{keywordflow}{raise} Exception(\textcolor{stringliteral}{'payment gate authentication failure!'})}
\DoxyCodeLine{153     balance\_dt=bank.get\_balance()}
\DoxyCodeLine{154     balance=balance\_dt[\textcolor{stringliteral}{'balance'}]}
\DoxyCodeLine{155     base\_currency=balance\_dt[\textcolor{stringliteral}{'base'}]}
\DoxyCodeLine{156     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} db.exists.currency(base\_currency):}
\DoxyCodeLine{157         currency=Currency(base\_currency)}
\DoxyCodeLine{158         db.inserts.add\_currency(base\_currency, currency.rate)}
\DoxyCodeLine{159     base\_currency\_id=db.gets.get\_currency\_id(base\_currency)}
\DoxyCodeLine{160     db.inserts.add\_bank\_account(cid, balance, bank\_name, branch\_number, account\_number, name\_reference, base\_currency\_id)}
\DoxyCodeLine{161     db.commit(lock)}
\DoxyCodeLine{162   \textcolor{keywordflow}{except} psycopg2.DatabaseError \textcolor{keyword}{as} error:}
\DoxyCodeLine{163     db.rollback(lock)}
\DoxyCodeLine{164     emsg=\textcolor{stringliteral}{"assigning bank account failed, error: "}+str(error)}
\DoxyCodeLine{165     logger.critical(emsg)}
\DoxyCodeLine{166     abort(500, emsg)}
\DoxyCodeLine{167   \textcolor{keywordflow}{except}:}
\DoxyCodeLine{168     db.rollback(lock)}
\DoxyCodeLine{169     emsg=\textcolor{stringliteral}{"adding bank account failed"}}
\DoxyCodeLine{170     logger.critical(emsg)}
\DoxyCodeLine{171     abort(401)}
\DoxyCodeLine{172   \textcolor{keywordflow}{finally}:}
\DoxyCodeLine{173     db.close()}
\DoxyCodeLine{174   \textcolor{keywordflow}{return} jsonify(\{\textcolor{stringliteral}{'balance'}:balance, \textcolor{stringliteral}{'base'}: base\_currency\}), 201}
\DoxyCodeLine{175 }
\DoxyCodeLine{176 @app.route(CONTACTS, methods=[\textcolor{stringliteral}{'POST'}])}
\DoxyCodeLine{177 @auth.login\_required}

\end{DoxyCode}
\mbox{\Hypertarget{namespacecore_1_1server_1_1server_a2ccd3f4fc783a6da9115970238b12230}\label{namespacecore_1_1server_1_1server_a2ccd3f4fc783a6da9115970238b12230}} 
\index{core.server.server@{core.server.server}!add\_contact@{add\_contact}}
\index{add\_contact@{add\_contact}!core.server.server@{core.server.server}}
\doxysubsubsection{\texorpdfstring{add\_contact()}{add\_contact()}}
{\footnotesize\ttfamily def core.\+server.\+server.\+add\+\_\+contact (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\begin{DoxyVerb}get the credential for the given contact
\end{DoxyVerb}
 

Definition at line 178 of file server.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{178 \textcolor{keyword}{def }\mbox{\hyperlink{namespacecore_1_1server_1_1server_a2ccd3f4fc783a6da9115970238b12230}{add\_contact}}():}
\DoxyCodeLine{179     \textcolor{stringliteral}{"""get the credential for the given contact}}
\DoxyCodeLine{180 \textcolor{stringliteral}{    """}}
\DoxyCodeLine{181     req=request.get\_json(force=\textcolor{keyword}{True})}
\DoxyCodeLine{182     email=req.get(\textcolor{stringliteral}{'email'}, \textcolor{keywordtype}{None})}
\DoxyCodeLine{183     logger.info(\textcolor{stringliteral}{"requesting contact"})}
\DoxyCodeLine{184     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} req \textcolor{keywordflow}{or} email==\textcolor{keywordtype}{None}:}
\DoxyCodeLine{185         emsg=\textcolor{stringliteral}{"incomplete URL"}}
\DoxyCodeLine{186         logger.debug(emsg)}
\DoxyCodeLine{187         abort(401, emsg)}
\DoxyCodeLine{188     payload=\{\}}
\DoxyCodeLine{189     db.init()}
\DoxyCodeLine{190     \textcolor{keywordflow}{try}:}
\DoxyCodeLine{191         db.repeatable\_read()}
\DoxyCodeLine{192         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} db.exists.account\_byemail(email):}
\DoxyCodeLine{193             emsg=\textcolor{stringliteral}{"contact doesn't exist"}}
\DoxyCodeLine{194             logger.critical(emsg)}
\DoxyCodeLine{195             \textcolor{keywordflow}{raise} Exception(emsg)}
\DoxyCodeLine{196         \textcolor{comment}{\#get credid for the email/password}}
\DoxyCodeLine{197         dest\_cid=db.gets.get\_client\_id\_byemail(email)}
\DoxyCodeLine{198         dest\_credid=db.gets.cid2credid(dest\_cid)}
\DoxyCodeLine{199         payload = \{\textcolor{stringliteral}{"credid"}: dest\_credid\}}
\DoxyCodeLine{200         db.commit()}
\DoxyCodeLine{201     \textcolor{keywordflow}{except} psycopg2.DatabaseError \textcolor{keyword}{as} error:}
\DoxyCodeLine{202         db.rollback()}
\DoxyCodeLine{203         emsg=\textcolor{stringliteral}{"request failed, error: \{\}"}.\mbox{\hyperlink{namespacecore_1_1server_1_1server_af52a36a8c5dfa466d4b0ecfe690fbaca}{format}}(str(error))}
\DoxyCodeLine{204         logger.critical(emsg)}
\DoxyCodeLine{205         abort(500, emsg)}
\DoxyCodeLine{206     \textcolor{keywordflow}{except} Exception \textcolor{keyword}{as} error:}
\DoxyCodeLine{207         db.rollback()}
\DoxyCodeLine{208         emsg=\textcolor{stringliteral}{"requesting failed, error: \{\}"}.\mbox{\hyperlink{namespacecore_1_1server_1_1server_af52a36a8c5dfa466d4b0ecfe690fbaca}{format}}(+str(error))}
\DoxyCodeLine{209         logger.critical(emsg)}
\DoxyCodeLine{210         abort(401, emsg)}
\DoxyCodeLine{211     \textcolor{keywordflow}{finally}:}
\DoxyCodeLine{212         db.close()}
\DoxyCodeLine{213     \textcolor{keywordflow}{return} jsonify(payload), 201}
\DoxyCodeLine{214 }
\DoxyCodeLine{215 @app.route(BALANCE, methods=[\textcolor{stringliteral}{'GET'}])}
\DoxyCodeLine{216 @auth.login\_required}

\end{DoxyCode}


References core.\+server.\+server.\+format.

\mbox{\Hypertarget{namespacecore_1_1server_1_1server_a971d8b7372b9e3548a266ff9373e0ad5}\label{namespacecore_1_1server_1_1server_a971d8b7372b9e3548a266ff9373e0ad5}} 
\index{core.server.server@{core.server.server}!authenticate@{authenticate}}
\index{authenticate@{authenticate}!core.server.server@{core.server.server}}
\doxysubsubsection{\texorpdfstring{authenticate()}{authenticate()}}
{\footnotesize\ttfamily def core.\+server.\+server.\+authenticate (\begin{DoxyParamCaption}\item[{}]{user,  }\item[{}]{passcode }\end{DoxyParamCaption})}

\begin{DoxyVerb}authenticate user, with username/password

user can be user's email, or registered name
\end{DoxyVerb}
 

Definition at line 37 of file server.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{37 \textcolor{keyword}{def }\mbox{\hyperlink{namespacecore_1_1server_1_1server_a971d8b7372b9e3548a266ff9373e0ad5}{authenticate}}(user, passcode):}
\DoxyCodeLine{38     \textcolor{stringliteral}{"""authenticate user, with username/password}}
\DoxyCodeLine{39 \textcolor{stringliteral}{}}
\DoxyCodeLine{40 \textcolor{stringliteral}{    user can be user's email, or registered name}}
\DoxyCodeLine{41 \textcolor{stringliteral}{    """}}
\DoxyCodeLine{42     db.init()}
\DoxyCodeLine{43     \textcolor{keywordflow}{try}:}
\DoxyCodeLine{44         db.repeatable\_read()}
\DoxyCodeLine{45         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} db.exists.user(user, passcode):}
\DoxyCodeLine{46             emsg=\textcolor{stringliteral}{'FAILURE PASSOWRD MISMATCH'}}
\DoxyCodeLine{47             logger.info(emsg)}
\DoxyCodeLine{48             \textcolor{keywordflow}{raise} Exception(emsg)}
\DoxyCodeLine{49         cid=db.gets.get\_cid(user, passcode)}
\DoxyCodeLine{50         credid=db.gets.cid2credid(cid)}
\DoxyCodeLine{51         db.commit()}
\DoxyCodeLine{52         session[\textcolor{stringliteral}{'credid'}]=credid}
\DoxyCodeLine{53         logger.info(\textcolor{stringliteral}{'AUTHENTICATION SUCCESS....'})}
\DoxyCodeLine{54     \textcolor{keywordflow}{except} psycopg2.DatabaseError \textcolor{keyword}{as} error:}
\DoxyCodeLine{55         db.rollback()}
\DoxyCodeLine{56         emsg=\textcolor{stringliteral}{"authentication failed with error: \{\}"}.\mbox{\hyperlink{namespacecore_1_1server_1_1server_af52a36a8c5dfa466d4b0ecfe690fbaca}{format}}(str(error))}
\DoxyCodeLine{57         logger.critical(emsg)}
\DoxyCodeLine{58         abort(500, emsg)}
\DoxyCodeLine{59         \textcolor{keywordflow}{return} \textcolor{keywordtype}{None} \textcolor{comment}{\#doesn't reach here}}
\DoxyCodeLine{60     \textcolor{keywordflow}{except}:}
\DoxyCodeLine{61         db.rollback()}
\DoxyCodeLine{62         emsg}
\DoxyCodeLine{63         logger.critical(\textcolor{stringliteral}{"authentication failed "})}
\DoxyCodeLine{64         abort(403, emsg)}
\DoxyCodeLine{65         \textcolor{keywordflow}{return} \textcolor{keywordtype}{None} \textcolor{comment}{\#doesn't reach here!}}
\DoxyCodeLine{66     \textcolor{keywordflow}{finally}:}
\DoxyCodeLine{67       db.close()}
\DoxyCodeLine{68     \textcolor{keywordflow}{return} user}
\DoxyCodeLine{69 }
\DoxyCodeLine{70 @auth.error\_handler}

\end{DoxyCode}


References core.\+server.\+server.\+format.

\mbox{\Hypertarget{namespacecore_1_1server_1_1server_af238ee0ce6d5e29834c8f207b7cd7c41}\label{namespacecore_1_1server_1_1server_af238ee0ce6d5e29834c8f207b7cd7c41}} 
\index{core.server.server@{core.server.server}!get\_balance@{get\_balance}}
\index{get\_balance@{get\_balance}!core.server.server@{core.server.server}}
\doxysubsubsection{\texorpdfstring{get\_balance()}{get\_balance()}}
{\footnotesize\ttfamily def core.\+server.\+server.\+get\+\_\+balance (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\begin{DoxyVerb}get balance of the current client

@return {'balance': balance, 'base': base}
\end{DoxyVerb}
 

Definition at line 217 of file server.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{217 \textcolor{keyword}{def }\mbox{\hyperlink{namespacecore_1_1server_1_1server_af238ee0ce6d5e29834c8f207b7cd7c41}{get\_balance}}():}
\DoxyCodeLine{218     \textcolor{stringliteral}{""" get balance of the current client}}
\DoxyCodeLine{219 \textcolor{stringliteral}{}}
\DoxyCodeLine{220 \textcolor{stringliteral}{    @return \{'balance': balance, 'base': base\}}}
\DoxyCodeLine{221 \textcolor{stringliteral}{    """}}
\DoxyCodeLine{222     balance=\textcolor{keywordtype}{None}}
\DoxyCodeLine{223     logger.info(\textcolor{stringliteral}{"balance requested"})}
\DoxyCodeLine{224     db.init()}
\DoxyCodeLine{225     \textcolor{keywordflow}{try}:}
\DoxyCodeLine{226         db.repeatable\_read()}
\DoxyCodeLine{227         cid=db.gets.credid2cid(session[\textcolor{stringliteral}{'credid'}])}
\DoxyCodeLine{228         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} db.exists.bank\_account\_bycid(cid):}
\DoxyCodeLine{229             \textcolor{keywordflow}{raise} Exception(\textcolor{stringliteral}{"no bank account added yet!"})}
\DoxyCodeLine{230         \textcolor{comment}{\#this would return balance in bank base}}
\DoxyCodeLine{231         balance=db.gets.get\_balance\_by\_credid(session[\textcolor{stringliteral}{'credid'}])}
\DoxyCodeLine{232         \textcolor{comment}{\# transform balance to user preference}}
\DoxyCodeLine{233         pref\_cur=db.gets.get\_preference\_currency\_bycid(cid)}
\DoxyCodeLine{234         amount=balance[\textcolor{stringliteral}{'balance'}]}
\DoxyCodeLine{235         base=balance[\textcolor{stringliteral}{'base'}]}
\DoxyCodeLine{236         currency=Currency(pref\_cur, base)}
\DoxyCodeLine{237         pref\_balance=currency.exchange(amount)}
\DoxyCodeLine{238         payload=\{\textcolor{stringliteral}{'balance'}: pref\_balance, \textcolor{stringliteral}{'base'}:pref\_cur\}}
\DoxyCodeLine{239         db.commit()}
\DoxyCodeLine{240     \textcolor{keywordflow}{except} psycopg2.DatabaseError \textcolor{keyword}{as} error:}
\DoxyCodeLine{241         db.rollback()}
\DoxyCodeLine{242         emsg=\textcolor{stringliteral}{"failed request, error: \{\} "}.\mbox{\hyperlink{namespacecore_1_1server_1_1server_af52a36a8c5dfa466d4b0ecfe690fbaca}{format}}(+str(error))}
\DoxyCodeLine{243         logger.critical()}
\DoxyCodeLine{244         abort(300, emsg)}
\DoxyCodeLine{245     \textcolor{keywordflow}{except}:}
\DoxyCodeLine{246         db.rollback()}
\DoxyCodeLine{247         emsg=\textcolor{stringliteral}{"failed request"}}
\DoxyCodeLine{248         logger.critical(emsg)}
\DoxyCodeLine{249         abort(300, emsg)}
\DoxyCodeLine{250     \textcolor{keywordflow}{finally}:}
\DoxyCodeLine{251         db.close()}
\DoxyCodeLine{252     \textcolor{keywordflow}{return} jsonify(payload), 201}
\DoxyCodeLine{253 }
\DoxyCodeLine{254 }
\DoxyCodeLine{255 @app.route(TOTAL\_BALANCE, methods=[\textcolor{stringliteral}{'GET'}])}
\DoxyCodeLine{256 @auth.login\_required}

\end{DoxyCode}


References core.\+server.\+server.\+format.

\mbox{\Hypertarget{namespacecore_1_1server_1_1server_a3ca347b24727d3a0c0789a0862916be4}\label{namespacecore_1_1server_1_1server_a3ca347b24727d3a0c0789a0862916be4}} 
\index{core.server.server@{core.server.server}!get\_total\_balance@{get\_total\_balance}}
\index{get\_total\_balance@{get\_total\_balance}!core.server.server@{core.server.server}}
\doxysubsubsection{\texorpdfstring{get\_total\_balance()}{get\_total\_balance()}}
{\footnotesize\ttfamily def core.\+server.\+server.\+get\+\_\+total\+\_\+balance (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\begin{DoxyVerb}get total balance of the current client

@return {'balance': balance, 'base': base}
\end{DoxyVerb}
 

Definition at line 257 of file server.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{257 \textcolor{keyword}{def }\mbox{\hyperlink{namespacecore_1_1server_1_1server_a3ca347b24727d3a0c0789a0862916be4}{get\_total\_balance}}():}
\DoxyCodeLine{258     \textcolor{stringliteral}{""" get total balance of the current client}}
\DoxyCodeLine{259 \textcolor{stringliteral}{}}
\DoxyCodeLine{260 \textcolor{stringliteral}{    @return \{'balance': balance, 'base': base\}}}
\DoxyCodeLine{261 \textcolor{stringliteral}{    """}}
\DoxyCodeLine{262     balance=\textcolor{keywordtype}{None}}
\DoxyCodeLine{263     logger.info(\textcolor{stringliteral}{"balance requested"})}
\DoxyCodeLine{264     db.init()}
\DoxyCodeLine{265     \textcolor{keywordflow}{try}:}
\DoxyCodeLine{266         db.repeatable\_read()}
\DoxyCodeLine{267         cid=db.gets.credid2cid(session[\textcolor{stringliteral}{'credid'}])}
\DoxyCodeLine{268         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} db.exists.bank\_account\_bycid(cid):}
\DoxyCodeLine{269             \textcolor{keywordflow}{raise} Exception(\textcolor{stringliteral}{"no bank account added yet!"})}
\DoxyCodeLine{270         \textcolor{comment}{\#this would return balance in bank base}}
\DoxyCodeLine{271         balance=db.gets.get\_total\_balance\_by\_credid(session[\textcolor{stringliteral}{'credid'}])}
\DoxyCodeLine{272         \textcolor{comment}{\# transform balance to user preference}}
\DoxyCodeLine{273         pref\_cur=db.gets.get\_preference\_currency\_bycid(cid)}
\DoxyCodeLine{274         amount=balance[\textcolor{stringliteral}{'balance'}]}
\DoxyCodeLine{275         base=balance[\textcolor{stringliteral}{'base'}]}
\DoxyCodeLine{276         currency=Currency(pref\_cur, base)}
\DoxyCodeLine{277         pref\_balance=currency.exchange(amount)}
\DoxyCodeLine{278         payload=\{\textcolor{stringliteral}{'balance'}: pref\_balance, \textcolor{stringliteral}{'base'}:pref\_cur\}}
\DoxyCodeLine{279         db.commit()}
\DoxyCodeLine{280     \textcolor{keywordflow}{except} psycopg2.DatabaseError \textcolor{keyword}{as} error:}
\DoxyCodeLine{281         db.rollback()}
\DoxyCodeLine{282         emsg=\textcolor{stringliteral}{"failed request, error: \{\} "}.\mbox{\hyperlink{namespacecore_1_1server_1_1server_af52a36a8c5dfa466d4b0ecfe690fbaca}{format}}(+str(error))}
\DoxyCodeLine{283         logger.critical()}
\DoxyCodeLine{284         abort(300, emsg)}
\DoxyCodeLine{285     \textcolor{keywordflow}{except}:}
\DoxyCodeLine{286         db.rollback()}
\DoxyCodeLine{287         emsg=\textcolor{stringliteral}{"failed request"}}
\DoxyCodeLine{288         logger.critical(emsg)}
\DoxyCodeLine{289         abort(300, emsg)}
\DoxyCodeLine{290     \textcolor{keywordflow}{finally}:}
\DoxyCodeLine{291         db.close()}
\DoxyCodeLine{292     \textcolor{keywordflow}{return} jsonify(payload), 201}
\DoxyCodeLine{293 }
\DoxyCodeLine{294 @app.route(CURRENCY, methods=[\textcolor{stringliteral}{'POST'}])}
\DoxyCodeLine{295 @auth.login\_required}

\end{DoxyCode}


References core.\+server.\+server.\+format.

\mbox{\Hypertarget{namespacecore_1_1server_1_1server_aaa1ff2a38465c5ade1f235cf197dde62}\label{namespacecore_1_1server_1_1server_aaa1ff2a38465c5ade1f235cf197dde62}} 
\index{core.server.server@{core.server.server}!make\_transaction@{make\_transaction}}
\index{make\_transaction@{make\_transaction}!core.server.server@{core.server.server}}
\doxysubsubsection{\texorpdfstring{make\_transaction()}{make\_transaction()}}
{\footnotesize\ttfamily def core.\+server.\+server.\+make\+\_\+transaction (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line 371 of file server.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{371 \textcolor{keyword}{def }\mbox{\hyperlink{namespacecore_1_1server_1_1server_aaa1ff2a38465c5ade1f235cf197dde62}{make\_transaction}}():}
\DoxyCodeLine{372     req=request.get\_json(force=\textcolor{keyword}{True})}
\DoxyCodeLine{373     recipt\_credid=req[\textcolor{stringliteral}{'credid'}]}
\DoxyCodeLine{374     \textcolor{comment}{\# the amount of transaction in Euro}}
\DoxyCodeLine{375     orig\_amount=req[\textcolor{stringliteral}{'amount'}]}
\DoxyCodeLine{376     currency\_base=req.get(\textcolor{stringliteral}{'currency'}, EUR)}
\DoxyCodeLine{377     \textcolor{comment}{\#exchange amount to euro for processing}}
\DoxyCodeLine{378     to\_euro = Currency(EUR, currency\_base)}
\DoxyCodeLine{379     amount=to\_euro.exchange(orig\_amount)}
\DoxyCodeLine{380     trx\_name=req.get(\textcolor{stringliteral}{'trx\_name'}, \textcolor{stringliteral}{''})}
\DoxyCodeLine{381     \textcolor{comment}{\#TRANSACTION LIMITS IN EUROS}}
\DoxyCodeLine{382     max\_daily=\mbox{\hyperlink{namespacecore_1_1utils_ac13f32df1a27f40f8f3c89c01e40e18c}{daily\_limit}}()}
\DoxyCodeLine{383     max\_weekly=\mbox{\hyperlink{namespacecore_1_1utils_ace7833d9faa7284d9efbb4081fa80f11}{weekly\_limit}}()}
\DoxyCodeLine{384     \textcolor{comment}{\#here the weekly/daily conditions are pivoted by the current moment only, note that the bank system can have specific pivot hour (the first momemnt of the day, it's specific for the bank system, and need to be known before hand)}}
\DoxyCodeLine{385     week\_past=datetime.datetime.now()-\/datetime.timedelta(days=7)}
\DoxyCodeLine{386     day\_past=datetime.datetime.now()-\/datetime.timedelta(days=1)}
\DoxyCodeLine{387     \textcolor{comment}{\#TODO abide to the  the constrains}}
\DoxyCodeLine{388     logger.info(\textcolor{stringliteral}{"making purchase"})}
\DoxyCodeLine{389     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} req \textcolor{keywordflow}{or} amount==\textcolor{keywordtype}{None} \textcolor{keywordflow}{or} recipt\_credid==\textcolor{keywordtype}{None}:}
\DoxyCodeLine{390         emsg=\textcolor{stringliteral}{"incomplete URL empty request"}}
\DoxyCodeLine{391         logger.critical(emsg)}
\DoxyCodeLine{392         abort(401, emsg)}
\DoxyCodeLine{393     \textcolor{comment}{\#gid=req['id']}}
\DoxyCodeLine{394     db.init()}
\DoxyCodeLine{395     MAKE\_TRANSACTION\_LOCK=9}
\DoxyCodeLine{396     lock=MAKE\_TRANSACTION\_LOCK}
\DoxyCodeLine{397     print(\textcolor{stringliteral}{'start transaction'})}
\DoxyCodeLine{398     \textcolor{keywordflow}{try}:}
\DoxyCodeLine{399         db.lock\_advisory(lock)}
\DoxyCodeLine{400         \textcolor{comment}{\#if this client have a bank account yet}}
\DoxyCodeLine{401         cid=db.gets.credid2cid(session[\textcolor{stringliteral}{'credid'}])}
\DoxyCodeLine{402         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} db.exists.bank\_account\_bycid(cid):}
\DoxyCodeLine{403             \textcolor{keywordflow}{raise} Exception(\textcolor{stringliteral}{"client doesn't have any associated bank account!"})}
\DoxyCodeLine{404         \textcolor{comment}{\#balance in bank base}}
\DoxyCodeLine{405         src\_balance=db.gets.get\_balance\_by\_credid(session[\textcolor{stringliteral}{'credid'}])}
\DoxyCodeLine{406         src\_balance\_exchange=Currency(EUR, src\_balance[\textcolor{stringliteral}{'base'}])}
\DoxyCodeLine{407         src\_balance\_euro=src\_balance\_exchange.exchange(src\_balance[\textcolor{stringliteral}{'balance'}])}
\DoxyCodeLine{408         \textcolor{keywordflow}{if} src\_balance\_euro<amount+FEE:}
\DoxyCodeLine{409             emsg=\textcolor{stringliteral}{"client doesn't have enough credit to make transaction"}}
\DoxyCodeLine{410             logger.critical(emsg)}
\DoxyCodeLine{411             \textcolor{keywordflow}{raise} Exception(emsg)}
\DoxyCodeLine{412         \textcolor{comment}{\#get transaction sum in euro}}
\DoxyCodeLine{413         weekly\_trx\_sum=db.gets.get\_transactions\_sum(session[\textcolor{stringliteral}{'credid'}], week\_past)}
\DoxyCodeLine{414         daily\_trx\_sum=db.gets.get\_transactions\_sum(session[\textcolor{stringliteral}{'credid'}], day\_past)}
\DoxyCodeLine{415         print(\textcolor{stringliteral}{'got trx sum! weekly: \{\}, daily\{\}'}.\mbox{\hyperlink{namespacecore_1_1server_1_1server_af52a36a8c5dfa466d4b0ecfe690fbaca}{format}}(weekly\_trx\_sum, daily\_trx\_sum))}
\DoxyCodeLine{416         \textcolor{keywordflow}{if} weekly\_trx\_sum+amount>max\_weekly \textcolor{keywordflow}{or} daily\_trx\_sum+amount>max\_daily:}
\DoxyCodeLine{417             emsg=\textcolor{stringliteral}{"client passed the daily/weekly limit"}}
\DoxyCodeLine{418             logger.info(emsg)}
\DoxyCodeLine{419             \textcolor{keywordflow}{raise} Exception(emsg)}
\DoxyCodeLine{420         cur\_id=db.gets.get\_currency\_id(currency\_base)}
\DoxyCodeLine{421         \textcolor{comment}{\#add transaction}}
\DoxyCodeLine{422         db.inserts.insert\_trx(recipt\_credid, session[\textcolor{stringliteral}{'credid'}], amount, cur\_id, trx\_name)}
\DoxyCodeLine{423         \textcolor{comment}{\#TODO this can be minimized directly by credid}}
\DoxyCodeLine{424         \textcolor{comment}{\#dest balance in bank base}}
\DoxyCodeLine{425         dest\_balance=db.gets.get\_balance\_by\_credid(recipt\_credid)}
\DoxyCodeLine{426         dest\_balance\_exchange=Currency(EUR, dest\_balance[\textcolor{stringliteral}{'base'}])}
\DoxyCodeLine{427         dest\_balance\_euro=dest\_balance\_exchange.exchange(dest\_balance[\textcolor{stringliteral}{'balance'}])}
\DoxyCodeLine{428         src\_balance\_new=src\_balance\_euro-\/(amount+FEE)}
\DoxyCodeLine{429         dest\_balance\_new=dest\_balance\_euro+amount}
\DoxyCodeLine{430         \textcolor{comment}{\#exchange back to bank bas}}
\DoxyCodeLine{431         src\_balance\_new=src\_balance\_exchange.exchange\_back(src\_balance\_new)}
\DoxyCodeLine{432         dest\_balance\_new=dest\_balance\_exchange.exchange\_back(dest\_balance\_new)}
\DoxyCodeLine{433         src\_cid=db.gets.credid2cid(session[\textcolor{stringliteral}{'credid'}])}
\DoxyCodeLine{434         des\_cid=db.gets.credid2cid(recipt\_credid)}
\DoxyCodeLine{435         \textcolor{keywordflow}{if} src\_cid==des\_cid:}
\DoxyCodeLine{436             print(\textcolor{stringliteral}{"src/dest \{\}/\{\}"}.\mbox{\hyperlink{namespacecore_1_1server_1_1server_af52a36a8c5dfa466d4b0ecfe690fbaca}{format}}(src\_cid, des\_cid))}
\DoxyCodeLine{437             emsg=\textcolor{stringliteral}{"you can't make transaction with oneself!"}}
\DoxyCodeLine{438             logger.critical(emsg)}
\DoxyCodeLine{439             \textcolor{keywordflow}{raise} Exception(emsg)}
\DoxyCodeLine{440         print(\textcolor{stringliteral}{'XXX -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ update balance?!'})}
\DoxyCodeLine{441         db.updates.update\_account(src\_cid, src\_balance\_new)}
\DoxyCodeLine{442         db.updates.update\_account(des\_cid, dest\_balance\_new)}
\DoxyCodeLine{443         trx = \{\textcolor{stringliteral}{'trx\_dest'}: recipt\_credid,  \(\backslash\)}
\DoxyCodeLine{444                \textcolor{stringliteral}{'trx\_src'}: session[\textcolor{stringliteral}{'credid'}], \(\backslash\)}
\DoxyCodeLine{445                \textcolor{stringliteral}{'trx\_cost'}: orig\_amount, \(\backslash\)}
\DoxyCodeLine{446                \textcolor{stringliteral}{'trx\_name'}:trx\_name\}}
\DoxyCodeLine{447         payload=\{\textcolor{stringliteral}{'balance'}: src\_balance\_new, \(\backslash\)}
\DoxyCodeLine{448                  \textcolor{stringliteral}{'transactions'}: trx\}}
\DoxyCodeLine{449         db.commit()}
\DoxyCodeLine{450     \textcolor{keywordflow}{except} psycopg2.DatabaseError \textcolor{keyword}{as} error:}
\DoxyCodeLine{451         db.rollback()}
\DoxyCodeLine{452         emsg=\textcolor{stringliteral}{"transaction failed, error: \{\}"}.\mbox{\hyperlink{namespacecore_1_1server_1_1server_af52a36a8c5dfa466d4b0ecfe690fbaca}{format}}(str(error))}
\DoxyCodeLine{453         logger.critical(emsg)}
\DoxyCodeLine{454         abort(500, emsg)}
\DoxyCodeLine{455     \textcolor{keywordflow}{except}:}
\DoxyCodeLine{456         db.rollback()}
\DoxyCodeLine{457         emsg=\textcolor{stringliteral}{"transaction failed"}}
\DoxyCodeLine{458         logger.critical(emsg)}
\DoxyCodeLine{459         abort(401, emsg)}
\DoxyCodeLine{460     \textcolor{keywordflow}{finally}:}
\DoxyCodeLine{461         db.unlock\_advisory(lock)}
\DoxyCodeLine{462         db.close()}
\DoxyCodeLine{463     \textcolor{keywordflow}{return} jsonify(payload), 201}
\DoxyCodeLine{464 \textcolor{stringliteral}{'''}}
\DoxyCodeLine{465 \textcolor{stringliteral}{@app.route(GOODS, methods=['POST'])}}
\DoxyCodeLine{466 \textcolor{stringliteral}{@auth.login\_required}}
\DoxyCodeLine{467 \textcolor{stringliteral}{def add\_goods():}}
\DoxyCodeLine{468 \textcolor{stringliteral}{    req=request.get\_json(force=True)}}
\DoxyCodeLine{469 \textcolor{stringliteral}{    logger.info("adding new good to the market")}}
\DoxyCodeLine{470 \textcolor{stringliteral}{    \#TODO goods should be passed with authentication,}}
\DoxyCodeLine{471 \textcolor{stringliteral}{    \# how to authenticate both in requests, and in flask}}
\DoxyCodeLine{472 \textcolor{stringliteral}{    if not req or 'goods' not in req:}}
\DoxyCodeLine{473 \textcolor{stringliteral}{        logger.critical("URL is incomplete missing goods")}}
\DoxyCodeLine{474 \textcolor{stringliteral}{        abort(401)}}
\DoxyCodeLine{475 \textcolor{stringliteral}{    goods=\{\}}}
\DoxyCodeLine{476 \textcolor{stringliteral}{    db.init()}}
\DoxyCodeLine{477 \textcolor{stringliteral}{    lock=1}}
\DoxyCodeLine{478 \textcolor{stringliteral}{    try:}}
\DoxyCodeLine{479 \textcolor{stringliteral}{        db.lock\_advisory(lock)}}
\DoxyCodeLine{480 \textcolor{stringliteral}{        cid=db.gets.credid2cid(session['credid'])}}
\DoxyCodeLine{481 \textcolor{stringliteral}{        if cid==None:}}
\DoxyCodeLine{482 \textcolor{stringliteral}{            logger.critical("client not found associated with given id")}}
\DoxyCodeLine{483 \textcolor{stringliteral}{            abort(403)}}
\DoxyCodeLine{484 \textcolor{stringliteral}{            raise Exception("invalid client")}}
\DoxyCodeLine{485 \textcolor{stringliteral}{        goods=req['goods']}}
\DoxyCodeLine{486 \textcolor{stringliteral}{        for good in goods:}}
\DoxyCodeLine{487 \textcolor{stringliteral}{            print("good", good[0], good[1], good[2])}}
\DoxyCodeLine{488 \textcolor{stringliteral}{            gid=db.inserts.add\_good(good[0], good[1], good[2])}}
\DoxyCodeLine{489 \textcolor{stringliteral}{            db.inserts.add\_owner(cid, gid)}}
\DoxyCodeLine{490 \textcolor{stringliteral}{        db.commit(lock)}}
\DoxyCodeLine{491 \textcolor{stringliteral}{    except psycopg2.DatabaseError as error:}}
\DoxyCodeLine{492 \textcolor{stringliteral}{        db.rollback(lock)}}
\DoxyCodeLine{493 \textcolor{stringliteral}{        logger.critical("error adding good, error: "+str(error))}}
\DoxyCodeLine{494 \textcolor{stringliteral}{        abort(300)}}
\DoxyCodeLine{495 \textcolor{stringliteral}{    except:}}
\DoxyCodeLine{496 \textcolor{stringliteral}{        db.rollback(lock)}}
\DoxyCodeLine{497 \textcolor{stringliteral}{        logger.critical("error adding good")}}
\DoxyCodeLine{498 \textcolor{stringliteral}{        abort(300)}}
\DoxyCodeLine{499 \textcolor{stringliteral}{    finally:}}
\DoxyCodeLine{500 \textcolor{stringliteral}{        db.close()}}
\DoxyCodeLine{501 \textcolor{stringliteral}{    return jsonify(\{'goods':goods\}), 201}}
\DoxyCodeLine{502 \textcolor{stringliteral}{}}
\DoxyCodeLine{503 \textcolor{stringliteral}{@app.route(GOODS, methods=['GET'])}}
\DoxyCodeLine{504 \textcolor{stringliteral}{@auth.login\_required}}
\DoxyCodeLine{505 \textcolor{stringliteral}{def get\_goods():}}
\DoxyCodeLine{506 \textcolor{stringliteral}{    logger.info("requesting good")}}
\DoxyCodeLine{507 \textcolor{stringliteral}{    goods=\{\}}}
\DoxyCodeLine{508 \textcolor{stringliteral}{    db.init()}}
\DoxyCodeLine{509 \textcolor{stringliteral}{    try:}}
\DoxyCodeLine{510 \textcolor{stringliteral}{        db.repeatable\_read()}}
\DoxyCodeLine{511 \textcolor{stringliteral}{        goods = db.gets.get\_all\_goods()}}
\DoxyCodeLine{512 \textcolor{stringliteral}{        print('goods:', goods)}}
\DoxyCodeLine{513 \textcolor{stringliteral}{        db.commit()}}
\DoxyCodeLine{514 \textcolor{stringliteral}{    except psycopg2.DatabaseError as error:}}
\DoxyCodeLine{515 \textcolor{stringliteral}{        print('db except!')}}
\DoxyCodeLine{516 \textcolor{stringliteral}{        db.rollback()}}
\DoxyCodeLine{517 \textcolor{stringliteral}{        logger.critical("process failed, error: "+str(error))}}
\DoxyCodeLine{518 \textcolor{stringliteral}{        abort(300)}}
\DoxyCodeLine{519 \textcolor{stringliteral}{    except:}}
\DoxyCodeLine{520 \textcolor{stringliteral}{        print("except")}}
\DoxyCodeLine{521 \textcolor{stringliteral}{        db.rollback()}}
\DoxyCodeLine{522 \textcolor{stringliteral}{        logger.critical("process failed")}}
\DoxyCodeLine{523 \textcolor{stringliteral}{        abort(300)}}
\DoxyCodeLine{524 \textcolor{stringliteral}{    finally:}}
\DoxyCodeLine{525 \textcolor{stringliteral}{        db.close()}}
\DoxyCodeLine{526 \textcolor{stringliteral}{        \#TODO change column names}}
\DoxyCodeLine{527 \textcolor{stringliteral}{    return jsonify(\{"goods": goods\}), 201}}
\DoxyCodeLine{528 \textcolor{stringliteral}{@app.route(PURCHASE, methods=['POST'])}}
\DoxyCodeLine{529 \textcolor{stringliteral}{@auth.login\_required}}
\DoxyCodeLine{530 \textcolor{stringliteral}{def make\_purchase():}}
\DoxyCodeLine{531 \textcolor{stringliteral}{    req=request.get\_json(force=True)}}
\DoxyCodeLine{532 \textcolor{stringliteral}{    logger.info("making purchase")}}
\DoxyCodeLine{533 \textcolor{stringliteral}{    if not req:}}
\DoxyCodeLine{534 \textcolor{stringliteral}{        logger.critical("incomplete URL empty request")}}
\DoxyCodeLine{535 \textcolor{stringliteral}{        abort(401)}}
\DoxyCodeLine{536 \textcolor{stringliteral}{    gid=req['id']}}
\DoxyCodeLine{537 \textcolor{stringliteral}{    db.init()}}
\DoxyCodeLine{538 \textcolor{stringliteral}{    lock=4}}
\DoxyCodeLine{539 \textcolor{stringliteral}{    try:}}
\DoxyCodeLine{540 \textcolor{stringliteral}{        db.lock\_advisory(lock)}}
\DoxyCodeLine{541 \textcolor{stringliteral}{        \# cross reference owner\_id, with good\_id, with credentials}}
\DoxyCodeLine{542 \textcolor{stringliteral}{        \# return credential id of the owner}}
\DoxyCodeLine{543 \textcolor{stringliteral}{        credid=db.gets.get\_credid\_with\_gid(gid)}}
\DoxyCodeLine{544 \textcolor{stringliteral}{        \# make, and add new transaction such that increase,}}
\DoxyCodeLine{545 \textcolor{stringliteral}{        \# and decrease of the src/des balance need to be performed in single transaction, then add the transactioin to the ledger, if failed rollback}}
\DoxyCodeLine{546 \textcolor{stringliteral}{        cost=db.gets.get\_new\_price(gid)+FEE}}
\DoxyCodeLine{547 \textcolor{stringliteral}{        src\_balance=db.gets.get\_balance\_by\_credid(session['credid'])-\/(cost+FEE)}}
\DoxyCodeLine{548 \textcolor{stringliteral}{        des\_balance=db.gets.get\_balance\_by\_credid(credid)+cost}}
\DoxyCodeLine{549 \textcolor{stringliteral}{        src\_cid=db.gets.credid2cid(session['credid'])}}
\DoxyCodeLine{550 \textcolor{stringliteral}{        des\_cid=db.gets.credid2cid(credid)}}
\DoxyCodeLine{551 \textcolor{stringliteral}{        if src\_cid==des\_cid:}}
\DoxyCodeLine{552 \textcolor{stringliteral}{            logger.critical("you can't make purchase with oneself!")}}
\DoxyCodeLine{553 \textcolor{stringliteral}{            abort(403)}}
\DoxyCodeLine{554 \textcolor{stringliteral}{            raise Exception("you can't make purchase with oneself!")}}
\DoxyCodeLine{555 \textcolor{stringliteral}{        db.updates.update\_account(src\_cid, src\_balance)}}
\DoxyCodeLine{556 \textcolor{stringliteral}{        db.updates.update\_account(des\_cid, des\_balance)}}
\DoxyCodeLine{557 \textcolor{stringliteral}{        \#TODO the ownership in the client side need to be updated as well,}}
\DoxyCodeLine{558 \textcolor{stringliteral}{        \# in the database, and in the stateful list in memory}}
\DoxyCodeLine{559 \textcolor{stringliteral}{        \# also fetch corresponding oid!}}
\DoxyCodeLine{560 \textcolor{stringliteral}{        \#update\_owner(oid, gid)}}
\DoxyCodeLine{561 \textcolor{stringliteral}{        trx = \{'trx\_dest': credid,}}
\DoxyCodeLine{562 \textcolor{stringliteral}{               'trx\_src': session['credid'],}}
\DoxyCodeLine{563 \textcolor{stringliteral}{               'good\_id': gid\}}}
\DoxyCodeLine{564 \textcolor{stringliteral}{        payload=\{'balance': src\_balance,}}
\DoxyCodeLine{565 \textcolor{stringliteral}{                 'transactions': trx\}}}
\DoxyCodeLine{566 \textcolor{stringliteral}{        db.commit()}}
\DoxyCodeLine{567 \textcolor{stringliteral}{    except psycopg2.DatabaseError as error:}}
\DoxyCodeLine{568 \textcolor{stringliteral}{        db.rollback()}}
\DoxyCodeLine{569 \textcolor{stringliteral}{        logger.critical("purchase failed, error: "+str(error))}}
\DoxyCodeLine{570 \textcolor{stringliteral}{        abort(300)}}
\DoxyCodeLine{571 \textcolor{stringliteral}{    except:}}
\DoxyCodeLine{572 \textcolor{stringliteral}{        db.rollback()}}
\DoxyCodeLine{573 \textcolor{stringliteral}{        logger.critical("purchase failed")}}
\DoxyCodeLine{574 \textcolor{stringliteral}{        abort(300)}}
\DoxyCodeLine{575 \textcolor{stringliteral}{    finally:}}
\DoxyCodeLine{576 \textcolor{stringliteral}{        db.unlock\_advisory(lock)}}
\DoxyCodeLine{577 \textcolor{stringliteral}{        db.close()}}
\DoxyCodeLine{578 \textcolor{stringliteral}{    return jsonify(payload), 201}}
\DoxyCodeLine{579 \textcolor{stringliteral}{'''}}
\DoxyCodeLine{580 }

\end{DoxyCode}


References core.\+utils.\+daily\+\_\+limit(), core.\+server.\+server.\+format, and core.\+utils.\+weekly\+\_\+limit().

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacecore_1_1server_1_1server_aaa1ff2a38465c5ade1f235cf197dde62_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacecore_1_1server_1_1server_a7abed3618dce8dfc82db88504621e7fa}\label{namespacecore_1_1server_1_1server_a7abed3618dce8dfc82db88504621e7fa}} 
\index{core.server.server@{core.server.server}!register\_client@{register\_client}}
\index{register\_client@{register\_client}!core.server.server@{core.server.server}}
\doxysubsubsection{\texorpdfstring{register\_client()}{register\_client()}}
{\footnotesize\ttfamily def core.\+server.\+server.\+register\+\_\+client (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\begin{DoxyVerb}register new client with email/name + password, expected json body would have keys ["name", "email", "passcode"]\end{DoxyVerb}
 

Definition at line 75 of file server.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{75 \textcolor{keyword}{def }\mbox{\hyperlink{namespacecore_1_1server_1_1server_a7abed3618dce8dfc82db88504621e7fa}{register\_client}}():}
\DoxyCodeLine{76   \textcolor{stringliteral}{"""register new client with email/name + password, expected json body would have keys ["name", "email", "passcode"]}}
\DoxyCodeLine{77 \textcolor{stringliteral}{}}
\DoxyCodeLine{78 \textcolor{stringliteral}{  """}}
\DoxyCodeLine{79   req=request.get\_json(force=\textcolor{keyword}{True})}
\DoxyCodeLine{80   name=req.get(\textcolor{stringliteral}{'name'}, \textcolor{keywordtype}{None})}
\DoxyCodeLine{81   passcode=req.get(\textcolor{stringliteral}{'passcode'}, \textcolor{keywordtype}{None})}
\DoxyCodeLine{82   email=req.get(\textcolor{stringliteral}{'email'}, \textcolor{keywordtype}{None})}
\DoxyCodeLine{83   cur\_pref=req.get(\textcolor{stringliteral}{'cur\_pref'}, EUR)}
\DoxyCodeLine{84   \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} req \textcolor{keywordflow}{or} name==\textcolor{keywordtype}{None} \textcolor{keywordflow}{or} email==\textcolor{keywordtype}{None} \textcolor{keywordflow}{or} passcode==\textcolor{keywordtype}{None}:}
\DoxyCodeLine{85     logger.critical(\textcolor{stringliteral}{"url is incomplete"})}
\DoxyCodeLine{86     abort(401, \textcolor{stringliteral}{'incomplete post payload'})}
\DoxyCodeLine{87   cred\_id=\mbox{\hyperlink{namespaceserver_1_1server_a474f4b5138fb289357b6b044f80bf3b3}{get\_credid}}(email)}
\DoxyCodeLine{88   logger.info(\textcolor{stringliteral}{"registering trader for client: \{\}"}.\mbox{\hyperlink{namespacecore_1_1server_1_1server_af52a36a8c5dfa466d4b0ecfe690fbaca}{format}}(name))}
\DoxyCodeLine{89   bid=0}
\DoxyCodeLine{90   db.init()}
\DoxyCodeLine{91   lock=2}
\DoxyCodeLine{92   \textcolor{keywordflow}{try}:}
\DoxyCodeLine{93       db.lock\_advisory(lock)}
\DoxyCodeLine{94       email\_exists=db.exists.account\_byemail(email)}
\DoxyCodeLine{95       \textcolor{keywordflow}{if} email\_exists:}
\DoxyCodeLine{96           print(\textcolor{stringliteral}{'email exists'})}
\DoxyCodeLine{97           abort(400)}
\DoxyCodeLine{98           logger.debug(\textcolor{stringliteral}{"account \{\}/\{\} + \{\} already exists"}.\(\backslash\)}
\DoxyCodeLine{99                        \mbox{\hyperlink{namespacecore_1_1server_1_1server_af52a36a8c5dfa466d4b0ecfe690fbaca}{format}}(name, email, passcode))}
\DoxyCodeLine{100           \textcolor{keywordflow}{raise} Exception(\textcolor{stringliteral}{"account already exists!"})}
\DoxyCodeLine{101       \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} db.exists.currency(cur\_pref):}
\DoxyCodeLine{102           currency=Currency(cur\_pref)}
\DoxyCodeLine{103           \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} currency.valid():}
\DoxyCodeLine{104               \textcolor{keywordflow}{raise} Exception(\textcolor{stringliteral}{"currency isn't supported!"})}
\DoxyCodeLine{105           db.inserts.add\_currency(cur\_pref, currency.rate)}
\DoxyCodeLine{106       cur\_pref\_id=db.gets.get\_currency\_id(cur\_pref)}
\DoxyCodeLine{107       cid=db.inserts.add\_client(req[\textcolor{stringliteral}{'name'}], req[\textcolor{stringliteral}{'email'}], cur\_pref\_id)}
\DoxyCodeLine{108       logger.debug(\textcolor{stringliteral}{"client added"})}
\DoxyCodeLine{109       db.inserts.register(cid, passcode, cred\_id)}
\DoxyCodeLine{110       db.commit(lock)}
\DoxyCodeLine{111   \textcolor{keywordflow}{except} psycopg2.DatabaseError \textcolor{keyword}{as} error:}
\DoxyCodeLine{112     db.rollback(lock)}
\DoxyCodeLine{113     emsg=\textcolor{stringliteral}{"registering failed, error: "}.\mbox{\hyperlink{namespacecore_1_1server_1_1server_af52a36a8c5dfa466d4b0ecfe690fbaca}{format}}(str(error))}
\DoxyCodeLine{114     logger.critical(emsg)}
\DoxyCodeLine{115     abort(500, emsg)}
\DoxyCodeLine{116   \textcolor{keywordflow}{except}:}
\DoxyCodeLine{117     db.rollback(lock)}
\DoxyCodeLine{118     emsg=\textcolor{stringliteral}{"registering failed"}}
\DoxyCodeLine{119     logger.critical(emsg)}
\DoxyCodeLine{120     abort(403, emsg)}
\DoxyCodeLine{121   \textcolor{keywordflow}{finally}:}
\DoxyCodeLine{122     db.close()}
\DoxyCodeLine{123     res = \{\textcolor{stringliteral}{'cred\_id'}: cred\_id\}}
\DoxyCodeLine{124   \textcolor{keywordflow}{return} jsonify(res), 201}
\DoxyCodeLine{125 }
\DoxyCodeLine{126 @app.route(ADD\_BANK\_ACCOUNT, methods=[\textcolor{stringliteral}{'POST'}])}
\DoxyCodeLine{127 @auth.login\_required}

\end{DoxyCode}


References core.\+server.\+server.\+format, and server.\+server.\+get\+\_\+credid().

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacecore_1_1server_1_1server_a7abed3618dce8dfc82db88504621e7fa_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacecore_1_1server_1_1server_ae03340bacb313931ea21ed616bf75cf0}\label{namespacecore_1_1server_1_1server_ae03340bacb313931ea21ed616bf75cf0}} 
\index{core.server.server@{core.server.server}!unauthorized@{unauthorized}}
\index{unauthorized@{unauthorized}!core.server.server@{core.server.server}}
\doxysubsubsection{\texorpdfstring{unauthorized()}{unauthorized()}}
{\footnotesize\ttfamily def core.\+server.\+server.\+unauthorized (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line 71 of file server.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{71 \textcolor{keyword}{def }\mbox{\hyperlink{namespacecore_1_1server_1_1server_ae03340bacb313931ea21ed616bf75cf0}{unauthorized}}():}
\DoxyCodeLine{72     \textcolor{keywordflow}{return} make\_response(jsonify(\{\textcolor{stringliteral}{'error'}: \textcolor{stringliteral}{"forbidden access"}\}), 403)}
\DoxyCodeLine{73 }
\DoxyCodeLine{74 @app.route(REGISTER, methods=[\textcolor{stringliteral}{'POST'}])}

\end{DoxyCode}
\mbox{\Hypertarget{namespacecore_1_1server_1_1server_a5c1e2c8a284854a7b27c4fbf7144b038}\label{namespacecore_1_1server_1_1server_a5c1e2c8a284854a7b27c4fbf7144b038}} 
\index{core.server.server@{core.server.server}!update\_balance\_preference@{update\_balance\_preference}}
\index{update\_balance\_preference@{update\_balance\_preference}!core.server.server@{core.server.server}}
\doxysubsubsection{\texorpdfstring{update\_balance\_preference()}{update\_balance\_preference()}}
{\footnotesize\ttfamily def core.\+server.\+server.\+update\+\_\+balance\+\_\+preference (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\begin{DoxyVerb}update balance preference\end{DoxyVerb}
 

Definition at line 296 of file server.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{296 \textcolor{keyword}{def }\mbox{\hyperlink{namespacecore_1_1server_1_1server_a5c1e2c8a284854a7b27c4fbf7144b038}{update\_balance\_preference}}():}
\DoxyCodeLine{297     \textcolor{stringliteral}{"""update balance preference}}
\DoxyCodeLine{298 \textcolor{stringliteral}{}}
\DoxyCodeLine{299 \textcolor{stringliteral}{    """}}
\DoxyCodeLine{300     req=request.get\_json(force=\textcolor{keyword}{True})}
\DoxyCodeLine{301     base = req.get(\textcolor{stringliteral}{'base'}, \textcolor{keywordtype}{None})}
\DoxyCodeLine{302     logger.info(\textcolor{stringliteral}{"updating balance preference"})}
\DoxyCodeLine{303     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} req \textcolor{keywordflow}{or} base==\textcolor{keywordtype}{None}:}
\DoxyCodeLine{304         emsg=\textcolor{stringliteral}{'incomplete url'}}
\DoxyCodeLine{305         logger.cirtical(emsg)}
\DoxyCodeLine{306         abort(401, emsg)}
\DoxyCodeLine{307     CURRENCY\_LOCK=11}
\DoxyCodeLine{308     lock=CURRENCY\_LOCK}
\DoxyCodeLine{309     db.init()}
\DoxyCodeLine{310     \textcolor{keywordflow}{try}:}
\DoxyCodeLine{311         db.lock\_advisory(lock)}
\DoxyCodeLine{312         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} db.exists.currency(base):}
\DoxyCodeLine{313             currency=Currency(base)}
\DoxyCodeLine{314             db.inserts.add\_currency(basey, currency.rate)}
\DoxyCodeLine{315         base\_currency\_id=db.gets.get\_currency\_id(base\_currency)}
\DoxyCodeLine{316         cid=db.gets.credid2cid(session[\textcolor{stringliteral}{'credid'}])}
\DoxyCodeLine{317         db.updates.currency\_preference(cid, base)}
\DoxyCodeLine{318         db.commit()}
\DoxyCodeLine{319     \textcolor{keywordflow}{except} psycopg2.DatabaseError \textcolor{keyword}{as} error:}
\DoxyCodeLine{320         db.rollback()}
\DoxyCodeLine{321         emsg=\textcolor{stringliteral}{"request failure, error: \{\} "}.\mbox{\hyperlink{namespacecore_1_1server_1_1server_af52a36a8c5dfa466d4b0ecfe690fbaca}{format}}(str(error))}
\DoxyCodeLine{322         logger.critical(emsg)}
\DoxyCodeLine{323         abort(500, emsg)}
\DoxyCodeLine{324     \textcolor{keywordflow}{except} Exception \textcolor{keyword}{as} error:}
\DoxyCodeLine{325         db.rollback()}
\DoxyCodeLine{326         emsg=\textcolor{stringliteral}{"request failure, error: \{\}"}.\mbox{\hyperlink{namespacecore_1_1server_1_1server_af52a36a8c5dfa466d4b0ecfe690fbaca}{format}}(str(error))}
\DoxyCodeLine{327         logger.critical(emsg)}
\DoxyCodeLine{328         abort(401, emsg)}
\DoxyCodeLine{329     \textcolor{keywordflow}{finally}:}
\DoxyCodeLine{330         db.unlock\_advisory(lock)}
\DoxyCodeLine{331         db.close()}
\DoxyCodeLine{332 }
\DoxyCodeLine{333 @app.route(LEDGER, methods=[\textcolor{stringliteral}{'POST'}])}
\DoxyCodeLine{334 @auth.login\_required}

\end{DoxyCode}


References core.\+server.\+server.\+format.

\mbox{\Hypertarget{namespacecore_1_1server_1_1server_a97a5fcbe887022d384ea97f7d3b7dc47}\label{namespacecore_1_1server_1_1server_a97a5fcbe887022d384ea97f7d3b7dc47}} 
\index{core.server.server@{core.server.server}!update\_ledger@{update\_ledger}}
\index{update\_ledger@{update\_ledger}!core.server.server@{core.server.server}}
\doxysubsubsection{\texorpdfstring{update\_ledger()}{update\_ledger()}}
{\footnotesize\ttfamily def core.\+server.\+server.\+update\+\_\+ledger (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line 335 of file server.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{335 \textcolor{keyword}{def }\mbox{\hyperlink{namespacecore_1_1server_1_1server_a97a5fcbe887022d384ea97f7d3b7dc47}{update\_ledger}}():}
\DoxyCodeLine{336     req=request.get\_json(force=\textcolor{keyword}{True})}
\DoxyCodeLine{337     logger.info(\textcolor{stringliteral}{"requesting ledger update"})}
\DoxyCodeLine{338     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} req:}
\DoxyCodeLine{339         emsg=\textcolor{stringliteral}{"incomplete URL empty request!"}}
\DoxyCodeLine{340         logger.critical(emsg)}
\DoxyCodeLine{341         abort(401, emsg)}
\DoxyCodeLine{342     st\_dt=req[\textcolor{stringliteral}{'trx\_dt'}]}
\DoxyCodeLine{343     payload=\{\}}
\DoxyCodeLine{344     db.init()}
\DoxyCodeLine{345     lock=3}
\DoxyCodeLine{346     \textcolor{keywordflow}{try}:}
\DoxyCodeLine{347         db.lock\_advisory(lock)}
\DoxyCodeLine{348         sells\_trax=db.gets.get\_sells(session[\textcolor{stringliteral}{'credid'}], st\_dt).to\_json()}
\DoxyCodeLine{349         logger.debug(\textcolor{stringliteral}{"sells: \{\}"}.\mbox{\hyperlink{namespacecore_1_1server_1_1server_af52a36a8c5dfa466d4b0ecfe690fbaca}{format}}(sells\_trax))}
\DoxyCodeLine{350         balance=db.gets.get\_balance\_by\_credid(session[\textcolor{stringliteral}{'credid'}])}
\DoxyCodeLine{351         payload=\{\textcolor{stringliteral}{'transactions'}: sells\_trax, \(\backslash\)}
\DoxyCodeLine{352                  \textcolor{stringliteral}{'balance'}: balance\}}
\DoxyCodeLine{353         db.commit()}
\DoxyCodeLine{354     \textcolor{keywordflow}{except} psycopg2.DatabaseError \textcolor{keyword}{as} error:}
\DoxyCodeLine{355         db.rollback()}
\DoxyCodeLine{356         emsg=\textcolor{stringliteral}{"request failure, error: \{\}"}.\mbox{\hyperlink{namespacecore_1_1server_1_1server_af52a36a8c5dfa466d4b0ecfe690fbaca}{format}}(str(error))}
\DoxyCodeLine{357         logger.critical(emsg)}
\DoxyCodeLine{358         abort(500, emsg)}
\DoxyCodeLine{359     \textcolor{keywordflow}{except}:}
\DoxyCodeLine{360         db.rollback()}
\DoxyCodeLine{361         emsg=\textcolor{stringliteral}{"request failure"}}
\DoxyCodeLine{362         logger.critical(emsg)}
\DoxyCodeLine{363         abort(401, emsg)}
\DoxyCodeLine{364     \textcolor{keywordflow}{finally}:}
\DoxyCodeLine{365         db.unlock\_advisory(lock)}
\DoxyCodeLine{366         db.close()}
\DoxyCodeLine{367     \textcolor{keywordflow}{return} jsonify(payload), 201}
\DoxyCodeLine{368 }
\DoxyCodeLine{369 @app.route(TRANSACTION, methods=[\textcolor{stringliteral}{'POST'}])}
\DoxyCodeLine{370 @auth.login\_required}

\end{DoxyCode}


References core.\+server.\+server.\+format.



\doxysubsection{Variable Documentation}
\mbox{\Hypertarget{namespacecore_1_1server_1_1server_a67e902b543f6cff982320c5d78af065e}\label{namespacecore_1_1server_1_1server_a67e902b543f6cff982320c5d78af065e}} 
\index{core.server.server@{core.server.server}!app@{app}}
\index{app@{app}!core.server.server@{core.server.server}}
\doxysubsubsection{\texorpdfstring{app}{app}}
{\footnotesize\ttfamily core.\+server.\+server.\+app = Flask(\textquotesingle{}tahweela\textquotesingle{})}



Definition at line 31 of file server.\+py.

\mbox{\Hypertarget{namespacecore_1_1server_1_1server_a43a2e2d9bdeff715032f6df4b5396792}\label{namespacecore_1_1server_1_1server_a43a2e2d9bdeff715032f6df4b5396792}} 
\index{core.server.server@{core.server.server}!auth@{auth}}
\index{auth@{auth}!core.server.server@{core.server.server}}
\doxysubsubsection{\texorpdfstring{auth}{auth}}
{\footnotesize\ttfamily core.\+server.\+server.\+auth = H\+T\+T\+P\+Basic\+Auth()}



Definition at line 33 of file server.\+py.

\mbox{\Hypertarget{namespacecore_1_1server_1_1server_a39c673ca728dfb59e5fa8e3da0dd8be9}\label{namespacecore_1_1server_1_1server_a39c673ca728dfb59e5fa8e3da0dd8be9}} 
\index{core.server.server@{core.server.server}!db@{db}}
\index{db@{db}!core.server.server@{core.server.server}}
\doxysubsubsection{\texorpdfstring{db}{db}}
{\footnotesize\ttfamily core.\+server.\+server.\+db = \mbox{\hyperlink{classcore_1_1queries_1_1database_1_1database}{database}}(\mbox{\hyperlink{namespacecore_1_1server_1_1server_aacc32d3c57c3b577b7e2647528baaf8c}{db\+\_\+configs}})}



Definition at line 25 of file server.\+py.

\mbox{\Hypertarget{namespacecore_1_1server_1_1server_aacc32d3c57c3b577b7e2647528baaf8c}\label{namespacecore_1_1server_1_1server_aacc32d3c57c3b577b7e2647528baaf8c}} 
\index{core.server.server@{core.server.server}!db\_configs@{db\_configs}}
\index{db\_configs@{db\_configs}!core.server.server@{core.server.server}}
\doxysubsubsection{\texorpdfstring{db\_configs}{db\_configs}}
{\footnotesize\ttfamily string core.\+server.\+server.\+db\+\_\+configs = \char`\"{}dbname=\textquotesingle{}demo\textquotesingle{} user=\textquotesingle{}tahweela\textquotesingle{} password=\textquotesingle{}tahweela\textquotesingle{}\char`\"{}}



Definition at line 22 of file server.\+py.

\mbox{\Hypertarget{namespacecore_1_1server_1_1server_af424e5a3aad0db0c0b8cd014a17f2f5a}\label{namespacecore_1_1server_1_1server_af424e5a3aad0db0c0b8cd014a17f2f5a}} 
\index{core.server.server@{core.server.server}!debug@{debug}}
\index{debug@{debug}!core.server.server@{core.server.server}}
\doxysubsubsection{\texorpdfstring{debug}{debug}}
{\footnotesize\ttfamily core.\+server.\+server.\+debug}



Definition at line 582 of file server.\+py.

\mbox{\Hypertarget{namespacecore_1_1server_1_1server_adb9ec4bde84331664eb52b6412cb09fd}\label{namespacecore_1_1server_1_1server_adb9ec4bde84331664eb52b6412cb09fd}} 
\index{core.server.server@{core.server.server}!filemode@{filemode}}
\index{filemode@{filemode}!core.server.server@{core.server.server}}
\doxysubsubsection{\texorpdfstring{filemode}{filemode}}
{\footnotesize\ttfamily core.\+server.\+server.\+filemode}



Definition at line 28 of file server.\+py.

\mbox{\Hypertarget{namespacecore_1_1server_1_1server_a4cc77d0b54229e293423876599326ce9}\label{namespacecore_1_1server_1_1server_a4cc77d0b54229e293423876599326ce9}} 
\index{core.server.server@{core.server.server}!filename@{filename}}
\index{filename@{filename}!core.server.server@{core.server.server}}
\doxysubsubsection{\texorpdfstring{filename}{filename}}
{\footnotesize\ttfamily core.\+server.\+server.\+filename}



Definition at line 26 of file server.\+py.

\mbox{\Hypertarget{namespacecore_1_1server_1_1server_af52a36a8c5dfa466d4b0ecfe690fbaca}\label{namespacecore_1_1server_1_1server_af52a36a8c5dfa466d4b0ecfe690fbaca}} 
\index{core.server.server@{core.server.server}!format@{format}}
\index{format@{format}!core.server.server@{core.server.server}}
\doxysubsubsection{\texorpdfstring{format}{format}}
{\footnotesize\ttfamily core.\+server.\+server.\+format}



Definition at line 27 of file server.\+py.



Referenced by core.\+server.\+server.\+add\+\_\+contact(), core.\+server.\+server.\+authenticate(), core.\+server.\+server.\+get\+\_\+balance(), core.\+server.\+server.\+get\+\_\+total\+\_\+balance(), core.\+server.\+server.\+make\+\_\+transaction(), core.\+server.\+server.\+register\+\_\+client(), core.\+server.\+server.\+update\+\_\+balance\+\_\+preference(), and core.\+server.\+server.\+update\+\_\+ledger().

\mbox{\Hypertarget{namespacecore_1_1server_1_1server_a015041a18162a9c613c7321dd94c440e}\label{namespacecore_1_1server_1_1server_a015041a18162a9c613c7321dd94c440e}} 
\index{core.server.server@{core.server.server}!level@{level}}
\index{level@{level}!core.server.server@{core.server.server}}
\doxysubsubsection{\texorpdfstring{level}{level}}
{\footnotesize\ttfamily core.\+server.\+server.\+level}



Definition at line 29 of file server.\+py.

\mbox{\Hypertarget{namespacecore_1_1server_1_1server_a826f85e804e434c97db7e6738226d717}\label{namespacecore_1_1server_1_1server_a826f85e804e434c97db7e6738226d717}} 
\index{core.server.server@{core.server.server}!logger@{logger}}
\index{logger@{logger}!core.server.server@{core.server.server}}
\doxysubsubsection{\texorpdfstring{logger}{logger}}
{\footnotesize\ttfamily core.\+server.\+server.\+logger = logging.\+get\+Logger()}



Definition at line 30 of file server.\+py.

\mbox{\Hypertarget{namespacecore_1_1server_1_1server_a4802bb7a7a649b4f4334af4d1a39b4d5}\label{namespacecore_1_1server_1_1server_a4802bb7a7a649b4f4334af4d1a39b4d5}} 
\index{core.server.server@{core.server.server}!secret\_key@{secret\_key}}
\index{secret\_key@{secret\_key}!core.server.server@{core.server.server}}
\doxysubsubsection{\texorpdfstring{secret\_key}{secret\_key}}
{\footnotesize\ttfamily core.\+server.\+server.\+secret\+\_\+key}



Definition at line 32 of file server.\+py.

\mbox{\Hypertarget{namespacecore_1_1server_1_1server_ad2bf3b7601bca535e854bac189410f0b}\label{namespacecore_1_1server_1_1server_ad2bf3b7601bca535e854bac189410f0b}} 
\index{core.server.server@{core.server.server}!seed@{seed}}
\index{seed@{seed}!core.server.server@{core.server.server}}
\doxysubsubsection{\texorpdfstring{seed}{seed}}
{\footnotesize\ttfamily core.\+server.\+server.\+seed = int.\+from\+\_\+bytes(os.\+urandom(2), \textquotesingle{}big\textquotesingle{})}



Definition at line 11 of file server.\+py.

